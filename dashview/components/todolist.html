<!--removeIf(script)-->
<script type="text/javascript">
App.todolist = new Vue({
  template: '#template-todolist',
  data: {
    listItems: App.initialTodos,
    failed: false
  },
  mounted: function() {
    this.backgroundUpdate();
    setInterval(function(){
      this.backgroundUpdate();
    }.bind(this),(1000*60)*5)
  },
  methods: {
    backgroundUpdate: function() {
      $.ajax({
        type: 'GET',
        dataType: 'json',
        url:App.templateURL+'/listretriever.php',

        success: function(data){
          this.failed = false;
          this.listItems = data.listItems;

        }.bind(this),
        error: function(data) {
            if(!this.failed) {
              this.failed = new Date();
            }
        }.bind(this)

      });
    }
  }
});
</script>
<!--endRemoveIf(script)-->
<div class="todolist module">
  <div class="item" v-for="item in listItems" :class="{checked:item.checkedBy}">
    <div class="box":class="{checked:item.checkedBy}" :style="{background:item.checkedBy.color}"></div>
    <div class="title">{{item.title}}</div>
  </div>
  <fail-pill :failed="this.failed"/>
</div>
