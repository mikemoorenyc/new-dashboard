<!--removeIf(script)-->
<script type="text/javascript">
App.calendar= new Vue({
  template: '#template-calendar',
  data: {
    today:[],
    tomorrow:[],
    backgroundInterval: null
  },
  mounted: function() {
    this.userLoop();
    this.backgroundInterval = setInterval(function(){
      this.userLoop();
    }.bind(this),(1000*60)*10)

  },
  methods: {
    userLoop:function() {
      App.allUsers.forEach(function(e,i){
        if(e.calendarReady) {
          this.backgroundUpdate(e);
        }
      }.bind(this))
    },
    backgroundUpdate: function(user) {
      $.ajax({
        type: 'GET',

        url:App.homeURL+'/google-calendar/?id='+user.id,
        success: function(data){
          var items = data.items;
          var newToday = this.today.filter(function(e){
            return e.id !== user.id;
          });
          var newTomorrow = this.tomorrow.filter(function(e){
            return e.id !== user.id;
          })
          var today = new Date().getDate();
          var tomorrow = new Date().getDate()+1;
          items.forEach(function(e,i) {
            var item = {
             date: new Date(e.date),
             title: e.title,
             user: user
            }
            
            if(item.date.getDate() === today) {
              newToday.push(item);
            }
            if(item.date.getDate() === tomorrow) {
             newTomorrow.push(item); 
            }
          }.bind(this));
          function dateSort(a, b) {
              a =a.date;
              b = b.date;
              return a>b ? -1 : a<b ? 1 : 0;
          };
          newToday.sort(dateSort);
          newTomorrow.sort(dateSort);
          this.today = newToday;
          this.tomorrow = newTomorrow;
        }.bind(this)

      });

    }
  }
});
  
App.clock= new Vue({
  template: '#template-clock',
  data: {
    date: new Date()
  },
  mounted: function() {
    this.backgroundInterval = setInterval(function(){
      this.date = new Date();
    }.bind(this),(1000*30))

  },
  computed: {
   month: function() {
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Nov','Dec'];
     return months[this.date.getMonth()];
   },
   day: function() {
    var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat' ];
     return days[this.date.getDay()];
   },
   time: function() {
     var minutes = this.date.getMinutes();
     if(minutes<10) {
      minutes = '0'+minutes;
     }
     var ampm = 'am';
     var hours = this.date.getHours();
     return {
      minutes: minutes,
      hours: hours,
      ampm: ampm
     }
   }
  }
});
</script>
<!--endRemoveIf(script)-->
<div class="module calendar">
  
</div>
